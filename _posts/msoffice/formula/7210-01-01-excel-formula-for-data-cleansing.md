---
layout: post
title: "SUBSTITUTE,TRIM,CLEAN: 데이터 클렌징이 필요할 때 사용하는 함수식"
updated: 2021-08-06
tags: [msoffice,formula]
---

## 데이터 클렌징이 필요한 경우

"데이터 클렌징"이란 분석의 용이성을 위해 자료 형식을 통일하거나 불필요한 공백을 삭제하는 등의 일련의 작업을 의미한다.

외부 데이터베이스 등에서 받은 엑셀 파일을 편집하거나 분석할 때, 데이터베이스에서 받은 원본 데이터들이 다듬어지지 않아서, VLOOKUP 함수가 제대로 작동하지 않거나 하는 경험들이 있을 것이다. 보통 아래와 같은 경우들인데, 이럴 때 필요한 것이 데이터 클렌징이다.

- 텍스트 형식의 숫자와 실제 숫자가 혼재되어 있는 경우
- 화면에도 보이지않고 인쇄도 되지않는 특수한 문자가 숨겨져 있는 경우
- 데이터 앞이나 뒤, 그리고 텍스트 사이에 불필요한 공백들이 들어가 있는 경우
- 데이터에 \*, ?, \~ 와 같은 와일드카드 문자가 포함되어 있는 경우
{:.information}

## 와일드카드 문제

다른 것보다도 와일드카드에 대해서는 설명이 필요하다. 와일드카드는 조커와 같은 의미로 사용되는 문자로, \* 기호 자리에는 길이에 관계없이 (길이가 0 이어도 된다.) 어떠한 문자가 와도 상관없다는 의미이며, ? 기호 자리에는 하나의 아무문자가 와도 된다는 의미이며, \~ 기호는 와일드카드가 아닌 실제의 \*, ?, \~ 문자를 나타내기 위해 사용한다.

VLOOKUP 함수는 검색의 유용성을 위해 와일드카드를 허용하기에 아래와 같은 예기치못한 문제가 생길 수 있다.

![그림00](/img/msoffice/formula/formula-0013.png)

VLOOKUP 함수로 `XYZ**` 를 검색한 결과는 "3,000" 이 아닌 "1,000" 이다. `XYZ**` 을 사용했기 때문에 * 기호를 와일드카드로 판단하여 위부터 검색하여, 이에 해당하는 XYZ 의 판매액인 "1,000" 을 결과로 보이고 있는 것이다. (사실 위 예시에서 보인 상품명 5가지는 모두 XYZ** 에 해당되는 상품명들이다.)

검색하고자 하는 값을 `XYZ~*~*` 로 주어야 원하는 결과인 "3,000" 을 얻을 수 있다. 이는 버그가 아니라 VLOOKUP 함수 설계 자체에 따라 벌어지는 오작동이다.

## 데이터 클렌징 함수식

데이터 클렌징을 할 땐, 우선은 숫자를 먼저 봐서 텍스트 형식의 숫자인지 실제 숫자인지를 판별해야 한다. 그리고 분석하기 쉬운 한 쪽으로 통일을 하는 것이 좋다. 이에 대해서는 [별도 포스팅](/post/excel-convert-from-number-to-text)을 참고해보자.

다음으로 필요한 것이, 불필요한 공백, 숨은문자, 와일드카드를 제거하는 것이다.

![그림01](/img/msoffice/formula/formula-0014.png)

```excel
= SUBSTITUTE( SUBSTITUTE( SUBSTITUTE( TRIM( CLEAN( 데이터 )), "*", "#" ), "?", "$" ), "~", "^" )
```
{:.excel}

위 함수식에서 `데이터` 자리에는 클렌징이 필요한 데이터를 지정하면 된다. 그림을 보면 VLOOKUP 함수가 정확하게 의도한 대로 작동을 하고있다.

CLEAN 함수는 보이지도 않고 인쇄도 안되는 특수 문자를 제거하고, TRIM 은 텍스트 앞, 뒤 혹은 가운데에 껴 있는 불필요한 공백들을 제거하고, SUBSTITUTE 함수는 와일드카드 문자를 비슷하면서도 자주 사용하지는 않는 다른 문자로 치환한다.