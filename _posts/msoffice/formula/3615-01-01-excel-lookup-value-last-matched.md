---
layout: post
title: "INDEX,MATCH: 조건에 부합하는 가장 마지막 항목 검색"
updated: 2021-08-17
tags: [msoffice,formula]
---

## 조건 부합하는 가장 마지막 항목 검색 함수식

엑셀에서 VLOOKUP 이나 일반적인 INDEX, MATCH 함수와 같은 검색식을 사용할 때, 엑셀은 위부터 순서대로 검색하기 때문에 조건에 부합하는 항목이 나오면 그 즉시 검색을 중단한다. 그러나 경우에 따라서는 조건에 부합하는 항목들 중 가장 마지막에 있는 항목을 구하고자 할 때가 있다.

![그림00](/img/msoffice/formula/formula-0022.png)

```excel
{= INDEX( 검색대상열, MATCH( 2, 1/((조건식)*(조건식)* ... *(조건식)), 1 ))}
```
{:.excel}

수식 앞뒤로 붙어있는 중괄호 {} 를 제외한 수식을 타이핑하고 Ctrl + Shift + Enter 키를 눌러 **배열수식으로 입력**을 해야 정상작동 한다. 수식 입력셀에 포커싱을 두면, 입력한 수식 앞뒤로 중괄호가 보이는데, 배열수식으로 입력했음을 나타내는 표시다.

`(조건식)` 을 * 기호로 연결해주는 것만으로도 복수의 조건식을 만족하는 가장 마지막 항목을 찾는 것이 가능하다.

## 함수식 이해

`(조건식)` 의 결과는 True 혹은 False 이다. 그리고 엑셀은 이 값에 * 와 같은 사칙연산을 적용하면, True 는 1 로, False 는 0 으로 치환하여 계산을 한다. 따라서, `((조건식)*(조건식)* ... *(조건식))` 의 결과는 1 또는 0 이 된다. 모든 조건식이 True 인 경우에만 1 이 될 것이다.

이를 `1/ 결과` 와 같은 형태로 나눗셈을 한다. 만일 결과가 1 이었다면 나눗셈 결과는 1 이고, 결과가 0 이었다면 #DIV/0! 에러가 나오게 된다.

이를 MATCH 함수가 받는데, 위 엑셀 그림의 경우라면 `MATCH(2, {#DIV/0!, #DIV/0!, #DIV/0!, #DIV/0!, #DIV/0!, 1, #DIV/0!, #DIV/0!, 1, #DIV/0!}, 1)` 과 같은 형태가 된다. MATCH 함수의 세번째 인수가 1 이므로, MATCH 는 찾고자 하는 값인 2 이하의 값 중 가장 큰값을 찾게 된다. 에러인 #DIV/0! 은 무시하고, 가장 큰 값은 1 밖에 없으므로 가장 마지막 1 을 선택하게 되는 것이다.

이를 INDEX 함수가 다시 받아서 처리하는 구조다.

만일 조건들에 부합하는 값이 없다면 #N/A 에러가 발생한다.